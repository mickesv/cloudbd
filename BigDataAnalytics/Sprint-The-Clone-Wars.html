<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Sprint: The Clone Wars</title>
<!-- 2017-08-28 Mon 13:53 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Michael Unterkalmsteiner" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../org/org.css" />
<link rel="stylesheet" type="text/css" href="org/org.css" />
<link rel="stylesheet" type="text/css" href="/org/org.css" />
<script>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');  ga('create', 'UA-100681577-1', 'auto');  ga('send', 'pageview');</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Sprint: The Clone Wars</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. About This Sprint</a></li>
<li><a href="#sec-2">2. User Stories covered in this Sprint</a></li>
<li><a href="#sec-3">3. Introduction </a>
<ul>
<li><a href="#sec-3-1">3.1. Clone detection 101 </a></li>
<li><a href="#sec-3-2">3.2. ClonyMcCloneface</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Experiential Learning </a>
<ul>
<li><a href="#sec-4-1">4.1. Setup your development environment </a></li>
<li><a href="#sec-4-2">4.2. Get ClonyMcCloneface</a></li>
<li><a href="#sec-4-3">4.3. Complete the implementation </a></li>
<li><a href="#sec-4-4">4.4. Run the clone detection on a small data set</a></li>
<li><a href="#sec-4-5">4.5. Run the clone detection on a large data set</a></li>
<li><a href="#sec-4-6">4.6. Update Sprint Test Plan</a></li>
<li><a href="#sec-4-7">4.7. Update Course Backlog</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Sprint Acceptance Tests </a></li>
</ul>
</div>
</div>
<br/>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> About This Sprint</h2>
<div class="outline-text-2" id="text-1">
<p>
This sprint introduces a text-based clone detection algorithm and ClonyMcCloneface, a simple clone detector.
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> User Stories covered in this Sprint</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>As a developer I want to understand the principle ideas of code clone detection.
</li>
<li>As a developer I want to quickly identify code clones in a small code base (&lt;100 files).
</li>
<li>As a developer I want to be able to estimate the size of input data for an analysis task.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Introduction <a id="introduction" name="introduction"></a></h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Clone detection 101 <a id="101" name="101"></a></h3>
<div class="outline-text-3" id="text-3-1">
<p>
In the <a href="./BigDataAnalytics-Assignment.html">assignment outline</a> you have seen what a code clone is. Here we introduce a simple clone detection algorithm on which ClonyMcCloneface is based. The idea is simple: if we find one or more lines of code that are exactly the same, we have found a clone. Clones of size 1 are however quite uninteresting and much too common. The figure below contains 3 clones of size 1 (in lines 56, 64 and 67). Not very useful.
</p>


<div class="figure">
<p><img src="./images/one_line_clone.png" alt="one_line_clone.png" />
</p>
</div>

<p>
The idea is therefore to look at <i>chunks</i> of code instead of individual lines of code. A source code file is split up into chunks of size N, where N is the number of lines a chunk contains. If a file contains M lines of code, the number of chunks in a file is M-N+1. The figure below illustrates the idea.
</p>


<div class="figure">
<p><img src="./images/chunks.png" alt="chunks.png" />
</p>
</div>

<p>
The chunks shown on the left side are of size 5. We identify a chunk by its filename, and its beginning and ending line. Note that empty lines (lines 57, 60 and 65) do not contribute to chunk size. Now, to identify a clone, we
compare chunks, instead of lines. This will identify clones with a minimum of size N (5 in our example above).
</p>

<p>
There is one problem, though: we will detect clones of chunk size N and only of N, i.e. no larger clones. In order to find larger clones, we need to <i>expand</i> the initially detected clones of size N. The figure below illustrates the idea.
</p>


<div class="figure">
<p><img src="./images/clone.png" alt="clone.png" />
</p>
</div>

<p>
If we compare Chunk(File A, 54, 59) with Chunk(File B, 56, 61), we have a match. To expand this clone, we check if the next chunks in each file [Chunk(File A, 55, 61) and Chunk(File B, 57, 63)] are equivalent. Since they are, we continue this process until the chunks don&rsquo;t match anymore [Chunk(File A, 58, 63) and Chunk(File B, 60, 65)] and stop the expansion. We end up with a clone of size 7 as indicated in the figure above.
</p>


<p>
To summarize, the algorithm consists of the following steps:
</p>
<ol class="org-ol">
<li>Read in the source code and remove code comments, and whitespace that changes only the code layout.
</li>
<li>Split up each file into chunks of size N and store the chunks in a list.
</li>
<li>Iterate over the list of chunks and compare each chunk with each other chunk. 
</li>
<li>If equivalent chunks are found, expand the clone to identify the largest common number of equivalent chunks.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> ClonyMcCloneface</h3>
<div class="outline-text-3" id="text-3-2">
<p>
We have implemented the algorithm described in the previous section in a clone detector called ClonyMcCloneface (<a href="https://en.wikipedia.org/wiki/RRS_Sir_David_Attenborough">name reference</a>). You&rsquo;ll use and expand ClonyMcCloneface throughout this assignment. In this sprint, you are required to complete the tasks listed in <a href="#learning">Experiential Learning</a>. You know you are done with this sprint when you pass the <a href="#acceptance">Acceptance Tests</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Experiential Learning <a id="learning" name="learning"></a></h2>
<div class="outline-text-2" id="text-4">
<p>
The version of ClonyMcCloneface used in this sprint implements the ideas presented in the <a href="#101">introduction</a>. Your task is to complete some of the missing code, run the detector on different data sets and report on the observed results.
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Setup your development environment <a id="setup" name="setup"></a></h3>
<div class="outline-text-3" id="text-4-1">
<p>
You should conduct all development within a Virtualbox environment. This allows us to provide you support in case something is not working and you can keep your computer clutter free.
</p>

<ol class="org-ol">
<li>If you did not complete Sprint <a href="../Provisioning/Sprint-Getting-Started-Virtualisation.html">Getting Started with Virtualization</a>, now it&rsquo;s a good time. 
</li>
<li>Get this <a href="./material/vagrant_development_environment/Vagrantfile">Vagrantfile</a> and read the provision section to understand <i>what</i> will be installed <i>where</i>.
</li>
<li>Setup your development environment using vagrant.
</li>
<li>Login into the VM and install the development environment of your choice. We suggest you to use eclipse, but note that you cannot install the version provided by Ubuntu (3.8) since that one does not support Java 8. You need to install <a href="https://www.eclipse.org/downloads/?">eclipse 4.6 (Neon)</a> manually (here are some <a href="http://ubuntuhandbook.org/index.php/2016/01/how-to-install-the-latest-eclipse-in-ubuntu-16-04-15-10/">instructions</a>).
</li>
<li>Bonus task: adapt the Vagrantfile to install your favorite IDE (eclipse, netbeans, emacs, &#x2026;) so you don&rsquo;t have to do it manually in case you want to trash the VM.
</li>
</ol>

<div class="info">
<p>
<b>Checkpoint questions</b>
</p>

<ol class="org-ol">
<li>According to the directives in the vagrant file, which software packages are installed?
</li>
<li>Where is the Qualitas corpus installed?
</li>
</ol>

</div>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Get ClonyMcCloneface</h3>
<div class="outline-text-3" id="text-4-2">
<ol class="org-ol">
<li>Download the version for ClonyMcCloneface for this sprint.
<div class="org-src-container">

<pre class="src src-bash">$ wget ftp://custsrv1.bth.se/FTP/ClonyMcCloneface/The-Clone-Wars.tar.gz
</pre>
</div>
</li>
<li>Unpack the archive (it contains an eclipse project file, so you can import it directly into eclipse), open it in your IDE and start exploring the code.
</li>
</ol>

<div class="info">
<p>
<b>Checkpoint questions</b>
</p>

<ol class="org-ol">
<li value="3">Which class contains the <code>main</code> method?
</li>
</ol>

</div>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Complete the implementation <a id="complete" name="complete"></a></h3>
<div class="outline-text-3" id="text-4-3">
<p>
The objective of this activity is to familiarize yourself with the code in ClonyMcCloneface. If you run the unit tests, you will notice that some of them fail. Indeed, some of the code is incomplete. Your task is to find all locations marked with a TODO comment, implement the missing code (using what you have learned about the clone detection algorithm in the <a href="#introduction">Introduction</a>), and make all unit tests pass. 
</p>

<div class="info">
<p>
<b>Checkpoint questions</b>
</p>

<ol class="org-ol">
<li value="4">Which data structure is used to store <code>Clone</code> objects? 
</li>
<li>Why do you think that particular data structure was chosen?
</li>
</ol>

</div>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> Run the clone detection on a small data set</h3>
<div class="outline-text-3" id="text-4-4">
<p>
The provisioning of your development environment with vagrant has also installed the Qualitas corpus that contains the source code of 112 software systems. Take some time to explore the systems (see checkpoint questions).
</p>

<p>
Then, run the ClonyMcCloneface on the <code>ant</code> sytsem. The <code>main</code> method in class <code>NaiveDetector</code> expects two arguments:
</p>
<ol class="org-ol">
<li>The directory that contains the to-be-analysed source code
</li>
<li>The chunk size
</li>
</ol>

<p>
Open the file that contains the reported clones and check that the identified clones are indeed duplicated code fragments. If you completed the <a href="#complete">previous task</a>, the output of ClonyMcCloneface should look like this:
</p>

<pre class="example">
Root folder: /home/mun/Qualitas/QualitasCorpus-20130901r/Systems/ant
Total files/lines scanned: 1196/128219
Clones of size 20 or larger found: 47
Largest clone: 213

###Clone size: 213###
File: /home/mun/Qualitas/QualitasCorpus-20130901r/Systems/ant/ant-1.8.4/src/apache-ant-1.8.4/src/main/org/apache/tools/ant/taskdefs/optional/net/FTPTaskMirrorImpl.java | 86-298
File: /home/mun/Qualitas/QualitasCorpus-20130901r/Systems/ant/ant-1.8.4/src/apache-ant-1.8.4/src/main/org/apache/tools/ant/taskdefs/optional/net/FTP.java | 185-397

###Clone size: 167###
File: /home/mun/Qualitas/QualitasCorpus-20130901r/Systems/ant/ant-1.8.4/src/apache-ant-1.8.4/src/main/org/apache/tools/ant/taskdefs/optional/net/FTP.java | 505-671
File: /home/mun/Qualitas/QualitasCorpus-20130901r/Systems/ant/ant-1.8.4/src/apache-ant-1.8.4/src/main/org/apache/tools/ant/taskdefs/optional/net/FTPTaskMirrorImpl.java | 406-572

###Clone size: 158###
File: /home/mun/Qualitas/QualitasCorpus-20130901r/Systems/ant/ant-1.8.4/src/apache-ant-1.8.4/src/main/org/apache/tools/ant/taskdefs/optional/net/FTPTaskMirrorImpl.java | 655-812
File: /home/mun/Qualitas/QualitasCorpus-20130901r/Systems/ant/ant-1.8.4/src/apache-ant-1.8.4/src/main/org/apache/tools/ant/taskdefs/optional/net/FTP.java | 753-910
</pre>

<div class="info">
<p>
<b>Checkpoint questions</b>
</p>

<ol class="org-ol">
<li value="6">How many files does the Qualitas corpus contain? 
</li>
<li>How many of them are Java files?
</li>
<li>How much space do the Java files occupy on disk?
</li>
<li>How did you solve the malformed input problem (<code>MalformedInputException</code> is thrown when reading in some of the corpus files)?
</li>
</ol>

</div>
</div>
</div>

<div id="outline-container-sec-4-5" class="outline-3">
<h3 id="sec-4-5"><span class="section-number-3">4.5</span> Run the clone detection on a large data set</h3>
<div class="outline-text-3" id="text-4-5">
<p>
Now run ClonyMcCloneface on the complete Qualitas corpus.
</p>

<div class="info">
<p>
<b>Checkpoint questions</b>
</p>

<ol class="org-ol">
<li value="10">What happens here compared to the analysis of a smaller data set?
</li>
<li>If the analysis fails, why?
</li>
<li>Briefly discuss potential improvements to the detection algorithm and/or the used data structures. 
</li>
</ol>

</div>
</div>
</div>

<div id="outline-container-sec-4-6" class="outline-3">
<h3 id="sec-4-6"><span class="section-number-3">4.6</span> Update Sprint Test Plan</h3>
<div class="outline-text-3" id="text-4-6">
<p>
Go through the user stories for this sprint and make sure you have a clear understanding of how to solve each of them.
</p>

<p>
Revisit and update your risks and contingencies section.
</p>
</div>
</div>

<div id="outline-container-sec-4-7" class="outline-3">
<h3 id="sec-4-7"><span class="section-number-3">4.7</span> Update Course Backlog</h3>
<div class="outline-text-3" id="text-4-7">
<ul class="org-ul">
<li>Inspect the identified clones. Which ones would you try to eliminate? Which ones are harmless?
</li>
</ul>

<p>
Where do you go from here? Are there any questions that you want answered? Add them, along with a brief strategy for how to find an answer. 
</p>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Sprint Acceptance Tests <a id="acceptance" name="acceptance"></a></h2>
<div class="outline-text-2" id="text-5">
<p>
You are done with this sprint when:
</p>

<ul class="org-ul">
<li>You have answered all 12 checkpoint questions.
</li>
<li>You have implemented all missing code.
</li>
</ul>

<p>
You may also have:
</p>

<ul class="org-ul">
<li>Updated your Sprint Test Plan
</li>
<li>Updated your Course Backlog
</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Michael Unterkalmsteiner</p>
<p class="email">Email: <a href="mailto:Michael.Unterkalmsteiner@bth.se">Michael.Unterkalmsteiner@bth.se</a></p>
<p class="date">Created: 2017-08-28 Mon 13:53</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.2.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
