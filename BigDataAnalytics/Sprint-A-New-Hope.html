<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Sprint: A New Hope</title>
<!-- 2017-08-28 Mon 13:53 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Michael Unterkalmsteiner" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../org/org.css" />
<link rel="stylesheet" type="text/css" href="org/org.css" />
<link rel="stylesheet" type="text/css" href="/org/org.css" />
<script>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');  ga('create', 'UA-100681577-1', 'auto');  ga('send', 'pageview');</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Sprint: A New Hope</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. About This Sprint</a></li>
<li><a href="#sec-2">2. User Stories covered in this Sprint</a></li>
<li><a href="#sec-3">3. Introduction </a>
<ul>
<li><a href="#sec-3-1">3.1. Data transformation</a></li>
<li><a href="#sec-3-2">3.2. Hash functions and clone detection</a></li>
<li><a href="#sec-3-3">3.3. Clone expansion</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Learning Material</a>
<ul>
<li><a href="#sec-4-1">4.1. Videos</a></li>
<li><a href="#sec-4-2">4.2. Further Reading</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Experiential Learning</a>
<ul>
<li><a href="#sec-5-1">5.1. Setup your development environment</a></li>
<li><a href="#sec-5-2">5.2. Get ClonyMcCloneface</a></li>
<li><a href="#sec-5-3">5.3. First improvement: data transformation </a></li>
<li><a href="#sec-5-4">5.4. Second improvement: let hash tables do the hard work </a></li>
<li><a href="#sec-5-5">5.5. Update Sprint Test Plan</a></li>
<li><a href="#sec-5-6">5.6. Update Course Backlog</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Sprint Acceptance Tests</a></li>
</ul>
</div>
</div>
<br/>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> About This Sprint</h2>
<div class="outline-text-2" id="text-1">
<p>
In this sprint, we exploit the properties of a simple data structure to improve the clone detection algorithm.
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> User Stories covered in this Sprint</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>As a developer I want to improve the efficiency of code clone detection
</li>
<li>As a manager I want to understand the complexity that arises when requiring the analysis of large amounts of data
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Introduction <a id="intro" name="intro"></a></h2>
<div class="outline-text-2" id="text-3">
<p>
In the previous sprint in Section <a href="./Sprint-The-Clone-Wars.html#101">Clone detection 101</a>, we introduced a straightforward detection algorithm. However, as you have probably experienced in the assignment, the current implementation has limitations. In this sprint we will address some of the limitations by transforming the analyzed data and by storing it in a way that makes clone detection more efficient.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Data transformation</h3>
<div class="outline-text-3" id="text-3-1">
<p>
As we have illustrated in the previous sprint, the clone detection algorithm creates &ldquo;chunks&rdquo; of each source file, compares their content and, if they are equal, expands them line by line to find the largest common set of equal lines of code, i.e. a clone. The problem with this approach is that the content of the analyzed files is kept in memory, i.e. the more files we want to analyze, the more memory is used. 
</p>

<p>
A straightforward strategy to address this problem is to reduce the amount of data that needs to be maintained in memory (without storing it to disk). One approach to achieve this goal is to create a &ldquo;fingerprint&rdquo; of the data and compare those fingerprints instead of the actual data. We can generate fingerprints of the data with a hash function, i.e. a function that maps data of arbitrary size to data of fixed size [<a href="#1">1</a>]. The figure below illustrates the idea.
</p>


<div class="figure">
<p><img src="./images/fingerprint.png" alt="fingerprint.png" />
</p>
</div>

<p>
You can read more about hash functions here [<a href="#2">2</a>].
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Hash functions and clone detection</h3>
<div class="outline-text-3" id="text-3-2">
<p>
In the previous sprint the clone detection algorithm compared each chunk with each other chunk to identify clones. This means that with each chunk we add to the set of size n, we increase the number of required comparisons by n. The table below illustrates how the number of comparisons increases with the number of chunks n.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="right">n</th>
<th scope="col" class="right">Comparisons</th>
</tr>
</thead>
<tbody>
<tr>
<td class="right">2</td>
<td class="right">1</td>
</tr>

<tr>
<td class="right">3</td>
<td class="right">3</td>
</tr>

<tr>
<td class="right">4</td>
<td class="right">6</td>
</tr>

<tr>
<td class="right">5</td>
<td class="right">10</td>
</tr>

<tr>
<td class="right">6</td>
<td class="right">15</td>
</tr>

<tr>
<td class="right">7</td>
<td class="right">21</td>
</tr>

<tr>
<td class="right">8</td>
<td class="right">28</td>
</tr>

<tr>
<td class="right">9</td>
<td class="right">36</td>
</tr>

<tr>
<td class="right">10</td>
<td class="right">45</td>
</tr>

<tr>
<td class="right">11</td>
<td class="right">55</td>
</tr>

<tr>
<td class="right">12</td>
<td class="right">66</td>
</tr>
</tbody>
</table>

<p>
More generally, <i>n+1=(n*(n+1))/2</i>. Hence, with n=10000, the number of comparisons is 50.005.000! Assuming we can keep all data in memory, the runtime of this algorithm is prohibitively slow.
</p>

<p>
While we could throw more computing power on the problem, we shall first try to rethink the clone detection algorithm. Remember that a hashing function produces with a unique input a unique output, i.e. a fingerprint. We can use this property to our advantage for clone detection: if two chunks produce the same fingerprint, we have identified a clone (assuming the hash function does not produce any <a href="https://en.wikipedia.org/wiki/Collision_(computer_science)">collisions</a>)! In practice, this means that we store chunks in a hash table. Each entry in the hash table contains the list of chunks with equal fingerprints. The figure below illustrates the idea.
</p>


<div class="figure">
<p><img src="./images/hashedchunks.png" alt="hashedchunks.png" />
</p>
</div>

<p>
Clones are identified by traversing the hash table and expanding those entries that contain more than one chunk, i.e. entries 1ED322 and 7878GF in the figure above. Therefore, with e.g. a number of chunks n=10000, the number of checks as to whether a chunk is a clone is 10000 (not 50.005.000 as with the previous algorithm).
</p>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Clone expansion</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Since we are now storing chunks in a hash table instead of a list, we have to adapt the clone expansion algorithm from the previous sprint, <a href="./Sprint-The-Clone-Wars.html#101">Clone detection 101</a>. When the chunks were stored in a list, we could simply traverse the list forwards and backwards to expand the clone. This is now not possible anymore since the hash table does not store the chunks in sequence. One solution to this problem is to store the chunks in two hash tables:
</p>

<ol class="org-ol">
<li>By-hash table: stores chunks by their hash value in a list. With this table we detect clones.
</li>
<li>By-file table: stores chunks by their filename in a list. With this table we can lookup the chunks in a file and perform clone expansion.
</li>
</ol>

<p>
With these two data structures it is possible to first identify clones and then to expand them.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Learning Material</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Videos</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=yXmNmckX4sI&t=187s">Hashing: How and Why?</a>
</li>
<li><a href="https://www.youtube.com/watch?v=KyUTuwz_b7Q">Background on Hash Functions and Hash Tables</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Further Reading</h3>
<div class="outline-text-3" id="text-4-2">
<ol class="org-ol">
<li><a href="https://en.wikipedia.org/wiki/Hash_function">https://en.wikipedia.org/wiki/Hash_function</a> <a id="1" name="1"></a>
</li>
<li><a href="http://www.i-programmer.info/babbages-bag/479-hashing.html">http://www.i-programmer.info/babbages-bag/479-hashing.html</a> <a id="2" name="2"></a>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Experiential Learning</h2>
<div class="outline-text-2" id="text-5">
<p>
The version of ClonyMcCloneface used in this sprint implements the ideas presented in the <a href="#intro">introduction</a>. Your task is to complete some of the missing code, run the detector on different data sets and report on the observed results.
</p>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Setup your development environment</h3>
<div class="outline-text-3" id="text-5-1">
<p>
The same <a href="./Sprint-The-Clone-Wars.html#setup">instructions</a> as for the previous sprint apply.
</p>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Get ClonyMcCloneface</h3>
<div class="outline-text-3" id="text-5-2">
<ol class="org-ol">
<li>Download the version for ClonyMcCloneface for this sprint.
<div class="org-src-container">

<pre class="src src-bash">$ wget ftp://custsrv1.bth.se/FTP/ClonyMcCloneface/A-New-Hope.tar.gz
</pre>
</div>
</li>
<li>Unpack the archive (it contains an eclipse project file, so you can import it directly into eclipse).
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> First improvement: data transformation <a id="parta" name="parta"></a></h3>
<div class="outline-text-3" id="text-5-3">
<p>
Compare class <code>NaiveDetector</code> with the new class <code>HashDetector</code>. Note also the new package <code>se.bth.serl.clony.transformers</code> which contains the interface <code>IContentTransformer</code> and the two implementing classes <code>Noop</code> and <code>Hash</code>.
</p>

<p>
Your task is to complete the implementation of class <code>Hash</code>.
</p>

<div class="info">
<p>
<b>Checkpoint questions</b>
</p>

<ol class="org-ol">
<li>Compare the behavior of the <code>NaiveDetector</code> and the <code>HashDetector</code> on both a small part of the Qualitas corpus and the complete Qualitas corpus. What are the differences?
</li>
<li>What other content transformation would be helpful to implement (think of detecting different clone types)?
</li>
</ol>

</div>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Second improvement: let hash tables do the hard work <a id="partb" name="partb"></a></h3>
<div class="outline-text-3" id="text-5-4">
<p>
Compare class <code>HashDetector</code> with the class <code>FastHashDetector</code>. Note that chunks are not stored anymore in class <code>ListChunkCollection</code> but in class <code>HashChunkCollection</code>.
</p>

<p>
Your task is to complete the implementation of class <code>HashChunkCollection</code>.
</p>

<div class="info">
<p>
<b>Checkpoint questions</b>
</p>

<ol class="org-ol">
<li value="3">Compare the behavior of the <code>HashDetector</code> with the <code>FastHashDetector</code> on both a small part of the Qualitas corpus and the complete Qualitas corpus. What are the differences?
</li>
<li>What are the bottlenecks in the current implementation of the clone detection algorithm and what are potential strategies to overvome these limitations?
</li>
</ol>

</div>
</div>
</div>

<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5"><span class="section-number-3">5.5</span> Update Sprint Test Plan</h3>
<div class="outline-text-3" id="text-5-5">
<p>
Go through the user stories for this sprint and make sure you have a clear understanding of how to solve each of them.
</p>

<p>
Revisit and update your risks and contingencies section.
</p>
</div>
</div>

<div id="outline-container-sec-5-6" class="outline-3">
<h3 id="sec-5-6"><span class="section-number-3">5.6</span> Update Course Backlog</h3>
<div class="outline-text-3" id="text-5-6">
<p>
Where do you go from here? Are there any questions that you want answered? Add them, along with a brief strategy for how to find an answer. 
</p>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Sprint Acceptance Tests</h2>
<div class="outline-text-2" id="text-6">
<p>
You are done with this sprint when:
</p>

<ul class="org-ul">
<li>You have answered all 4 checkpoint questions.
</li>
<li>You have implemented all missing code.
</li>
</ul>

<p>
You may also have:
</p>
<ul class="org-ul">
<li>Updated your Sprint Test Plan.
</li>
<li>Updated your Course Backlog.
</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Michael Unterkalmsteiner</p>
<p class="email">Email: <a href="mailto:Michael.Unterkalmsteiner@bth.se">Michael.Unterkalmsteiner@bth.se</a></p>
<p class="date">Created: 2017-08-28 Mon 13:53</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.2.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
